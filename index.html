<!DOCTYPE html>
<html>
<head>
    <title>Visor AR del Metro</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.139.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.139.0/examples/js/loaders/GLTFLoader.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { margin: 0; overflow: hidden; }
        #ar-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #ar-canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="ar-container">
        <canvas id="ar-canvas"></canvas>
    </div>
    <script>
        // Escena y cámara de Three.js
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('ar-canvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;

        // Iluminación
        const ambientLight = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
        scene.add(ambientLight);

        // Cargador de GLTF y carga del modelo
        const loader = new THREE.GLTFLoader();
        let metroModel = null;
        const metroURL = 'https://raw.githubusercontent.com/OrigenArtificial/metro3d/main/metro%2001.glb'; // **TU URL AQUÍ**

        loader.load(metroURL, function (gltf) {
            metroModel = gltf.scene;
            scene.add(metroModel);
            metroModel.position.set(0, 0, -5);
        }, undefined, function (error) {
            console.error('Error al cargar el modelo del metro', error);
        });

        // Función de animación
        function animate() {
            requestAnimationFrame(animate);
            if (metroModel) {
                metroModel.rotation.y += 0.01;
            }
            renderer.render(scene, camera);
        }

        // Iniciar AR (ejemplo básico -  necesitarás adaptar esto)
        function startAR() {
             navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: 'environment'
                }
            }).then(function(stream) {
                renderer.xr.enabled = true;
                renderer.xr.setSession(stream);
                animate();
            }).catch(function(err) {
                console.error("Error al obtener la cámara", err);
            });
        }

        // Manejar el cambio de tamaño de la ventana
        window.addEventListener('resize', function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Iniciar la experiencia AR (esto normalmente estaría vinculado a un evento del usuario, como un botón)
        // startAR(); // Descomenta esto y vincúlalo a un botón en tu HTML
    </script>
</body>
</html>
